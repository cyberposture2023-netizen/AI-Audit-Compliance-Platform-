<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Compliance Platform v3.0</title>
    <link href="/css/tailwind.css" rel="stylesheet">
    <style>
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .tab-btn.active { 
            color: #2563eb; 
            border-bottom: 2px solid #2563eb;
        }
        .feature-badge {
            background: #10b981;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            margin-left: 8px;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen">
        <!-- Header -->
        <header class="bg-white shadow-sm border-b">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center py-4">
                    <div class="flex items-center">
                        <h1 class="text-2xl font-bold text-gray-800">AI Compliance Platform</h1>
                        <span class="feature-badge">v3.0</span>
                    </div>
                    <div class="flex items-center space-x-4">
                        <button id="exportPdf" class="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 text-sm">Export PDF</button>
                        <button id="exportExcel" class="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 text-sm">Export Excel</button>
                    </div>
                </div>
                
                <!-- Navigation Tabs -->
                <div class="flex space-x-1 border-b">
                    <button class="tab-btn active px-4 py-2" data-tab="assessmentTab">Assessment</button>
                    <button class="tab-btn px-4 py-2" data-tab="auditPlanTab">Audit Plan</button>
                    <button class="tab-btn px-4 py-2" data-tab="controlsTab">
                        Controls Dashboard <span class="feature-badge">NEW</span>
                    </button>
                    <button class="tab-btn px-4 py-2" data-tab="analyticsTab">
                        Analytics <span class="feature-badge">NEW</span>
                    </button>
                    <button class="tab-btn px-4 py-2" data-tab="reportsTab">
                        Reports <span class="feature-badge">NEW</span>
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Assessment Tab -->
            <div id="assessmentTab" class="tab-content active">
                <div class="bg-white rounded-lg shadow p-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">Compliance Assessment</h2>
                    <div class="mb-6 p-4 bg-blue-50 rounded-lg">
                        <h3 class="font-semibold text-blue-800 mb-2">PATCH-3 ENHANCEMENTS:</h3>
                        <ul class="list-disc list-inside text-blue-700">
                            <li>Proper UTF-8 encoding (no more ?? characters)</li>
                            <li>Enhanced UI with feature badges</li>
                            <li>New Reports tab</li>
                            <li>Export functionality</li>
                        </ul>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Select Framework</label>
                        <select id="frameworkSelect" class="border rounded px-3 py-2 w-full">
                            <option value="SOC 2">SOC 2</option>
                            <option value="HIPAA">HIPAA</option>
                            <option value="NIST CSF">NIST CSF</option>
                            <option value="PCI DSS">PCI DSS</option>
                            <option value="ISO 27001">ISO 27001</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Scope/Description</label>
                        <textarea id="scopeInput" class="border rounded px-3 py-2 w-full h-24" placeholder="Describe your compliance scope..."></textarea>
                    </div>
                    <button id="generateAssessment" class="px-6 py-3 bg-blue-500 text-white rounded hover:bg-blue-600">Generate Assessment</button>
                    <div id="assessmentResult" class="mt-4 p-4 bg-gray-50 rounded hidden"></div>
                </div>
            </div>

            <!-- Audit Plan Tab -->
            <div id="auditPlanTab" class="tab-content">
                <div class="bg-white rounded-lg shadow p-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">Audit Plan Generator</h2>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Framework</label>
                        <select id="auditFramework" class="border rounded px-3 py-2 w-full">
                            <option value="SOC 2">SOC 2</option>
                            <option value="HIPAA">HIPAA</option>
                            <option value="NIST CSF">NIST CSF</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Audit Scope</label>
                        <textarea id="auditScope" class="border rounded px-3 py-2 w-full h-24" placeholder="Describe audit scope..."></textarea>
                    </div>
                    <button id="generateAuditPlan" class="px-6 py-3 bg-green-500 text-white rounded hover:bg-green-600">Generate Audit Plan</button>
                    <div id="auditPlanResult" class="mt-4 p-4 bg-gray-50 rounded hidden"></div>
                </div>
            </div>

            <!-- Controls Dashboard Tab -->
            <div id="controlsTab" class="tab-content">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">Controls Dashboard</h2>
                    <p class="text-gray-600">Manage and track compliance controls</p>
                </div>
                
                <!-- Advanced Filters -->
                <div class="advanced-filters bg-white p-4 rounded-lg shadow mb-4">
                    <h3 class="text-lg font-semibold mb-3">Advanced Filters</h3>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-1">Search</label>
                            <input type="text" id="globalSearch" placeholder="Search controls..." class="w-full px-3 py-2 border rounded">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Status</label>
                            <select id="statusFilter" class="w-full px-3 py-2 border rounded">
                                <option value="">All Status</option>
                                <option value="Implemented">Implemented</option>
                                <option value="In Progress">In Progress</option>
                                <option value="Not Started">Not Started</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Framework</label>
                            <select id="frameworkFilter" class="w-full px-3 py-2 border rounded">
                                <option value="">All Frameworks</option>
                                <option value="SOC 2">SOC 2</option>
                                <option value="HIPAA">HIPAA</option>
                                <option value="NIST CSF">NIST CSF</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Risk Level</label>
                            <select id="riskFilter" class="w-full px-3 py-2 border rounded">
                                <option value="">All Risks</option>
                                <option value="High">High</option>
                                <option value="Medium">Medium</option>
                                <option value="Low">Low</option>
                            </select>
                        </div>
                    </div>
                    <div class="flex justify-between mt-3">
                        <button id="applyFilters" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">Apply Filters</button>
                        <button id="clearFilters" class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600">Clear All</button>
                        <button id="uploadEvidence" class="px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600">Upload Evidence</button>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow">
                    <div class="p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold">Compliance Controls</h3>
                            <button id="addControl" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">Add Control</button>
                        </div>
                        <div id="controlsList" class="space-y-4">
                            <div class="p-4 border rounded-lg">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <h4 class="font-semibold">Access Control Policy</h4>
                                        <p class="text-sm text-gray-600">SOC 2 - Implement user access reviews quarterly</p>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <span class="px-2 py-1 bg-green-100 text-green-800 text-xs rounded">Implemented</span>
                                        <span class="px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded">Medium Risk</span>
                                    </div>
                                </div>
                            </div>
                            <div class="p-4 border rounded-lg">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <h4 class="font-semibold">Data Encryption</h4>
                                        <p class="text-sm text-gray-600">HIPAA - Encrypt PHI at rest and in transit</p>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded">In Progress</span>
                                        <span class="px-2 py-1 bg-red-100 text-red-800 text-xs rounded">High Risk</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Analytics Dashboard Tab -->
            <div id="analyticsTab" class="tab-content">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">Compliance Analytics</h2>
                    <p class="text-gray-600">Real-time insights and compliance metrics</p>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <!-- Compliance Score -->
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-lg font-semibold mb-4">Compliance Score</h3>
                        <div class="text-center">
                            <div class="text-5xl font-bold text-blue-600 mb-2">76%</div>
                            <div class="text-sm text-gray-600">Overall compliance rate</div>
                        </div>
                        <div class="mt-4 space-y-2">
                            <div class="flex justify-between text-sm">
                                <span>SOC 2:</span>
                                <span class="font-semibold">85%</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span>HIPAA:</span>
                                <span class="font-semibold">72%</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span>NIST CSF:</span>
                                <span class="font-semibold">65%</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Risk Assessment -->
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-lg font-semibold mb-4">Risk Assessment</h3>
                        <div class="space-y-3">
                            <div>
                                <div class="flex justify-between text-sm mb-1">
                                    <span>High Risk</span>
                                    <span>12% (3 controls)</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div class="bg-red-500 h-2 rounded-full" style="width: 12%"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between text-sm mb-1">
                                    <span>Medium Risk</span>
                                    <span>48% (12 controls)</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div class="bg-yellow-500 h-2 rounded-full" style="width: 48%"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between text-sm mb-1">
                                    <span>Low Risk</span>
                                    <span>40% (10 controls)</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div class="bg-green-500 h-2 rounded-full" style="width: 40%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Implementation Timeline -->
                <div class="bg-white p-6 rounded-lg shadow">
                    <h3 class="text-lg font-semibold mb-4">Implementation Timeline</h3>
                    <div class="space-y-3">
                        <div>
                            <div class="text-sm mb-1">October 2024</div>
                            <div class="flex items-center space-x-2">
                                <div class="flex-1 bg-gray-200 rounded-full h-4">
                                    <div class="bg-green-500 h-4 rounded-full" style="width: 75%"></div>
                                </div>
                                <span class="text-xs text-gray-600">15/20</span>
                            </div>
                        </div>
                        <div>
                            <div class="text-sm mb-1">September 2024</div>
                            <div class="flex items-center space-x-2">
                                <div class="flex-1 bg-gray-200 rounded-full h-4">
                                    <div class="bg-green-500 h-4 rounded-full" style="width: 60%"></div>
                                </div>
                                <span class="text-xs text-gray-600">12/20</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- NEW: Reports Tab -->
            <div id="reportsTab" class="tab-content">
                <div class="bg-white rounded-lg shadow p-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">Compliance Reports</h2>
                    <p class="text-gray-600 mb-6">Generate and export compliance reports</p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Quick Reports -->
                        <div class="border rounded-lg p-4">
                            <h3 class="font-semibold mb-3">Quick Reports</h3>
                            <div class="space-y-2">
                                <button class="w-full text-left p-3 border rounded hover:bg-gray-50">
                                    <div class="font-medium">Compliance Summary</div>
                                    <div class="text-sm text-gray-600">Overall compliance status</div>
                                </button>
                                <button class="w-full text-left p-3 border rounded hover:bg-gray-50">
                                    <div class="font-medium">Risk Assessment</div>
                                    <div class="text-sm text-gray-600">Risk analysis report</div>
                                </button>
                                <button class="w-full text-left p-3 border rounded hover:bg-gray-50">
                                    <div class="font-medium">Evidence Tracking</div>
                                    <div class="text-sm text-gray-600">Evidence collection status</div>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Export Options -->
                        <div class="border rounded-lg p-4">
                            <h3 class="font-semibold mb-3">Export Options</h3>
                            <div class="space-y-3">
                                <button class="w-full flex items-center justify-between p-3 border rounded hover:bg-gray-50">
                                    <span>PDF Report</span>
                                    <span class="text-red-500">PDF</span>
                                </button>
                                <button class="w-full flex items-center justify-between p-3 border rounded hover:bg-gray-50">
                                    <span>Excel Spreadsheet</span>
                                    <span class="text-green-500">XLSX</span>
                                </button>
                                <button class="w-full flex items-center justify-between p-3 border rounded hover:bg-gray-50">
                                    <span>Executive Summary</span>
                                    <span class="text-blue-500">DOC</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Evidence Upload Modal -->
    <div id="evidenceModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
        <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
            <div class="mt-3 text-center">
                <h3 class="text-lg font-medium text-gray-900">Upload Evidence</h3>
                <div class="mt-4">
                    <input type="file" id="evidenceFile" class="mb-3 w-full">
                    <input type="text" id="controlId" placeholder="Control ID" class="mb-3 px-3 py-2 border rounded w-full">
                    <div class="flex justify-between">
                        <button id="uploadEvidenceBtn" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">Upload</button>
                        <button id="closeEvidenceModal" class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600">Cancel</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="/js/app.js"></script>
    <script src="/js/advanced-filters.js"></script>
    <script src="/js/dashboard-charts.js"></script>
    <script src="/js/reports.js"></script>

    <script>
        console.log("=== PATCH-3 LOADED ===");
        console.log("Features: Enhanced UI, Analytics, Reports, Export");
        
        // Tab system
        document.addEventListener('DOMContentLoaded', function() {
            console.log("Initializing enhanced tab system...");
            
            const tabButtons = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const targetTab = this.getAttribute('data-tab');
                    console.log("Switching to tab:", targetTab);
                    
                    // Update UI
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    tabContents.forEach(content => content.classList.remove('active'));
                    
                    this.classList.add('active');
                    document.getElementById(targetTab).classList.add('active');
                    
                    // Tab-specific initializations
                    if (targetTab === 'analyticsTab' && window.dashboardCharts) {
                        console.log("Initializing analytics charts...");
                        window.dashboardCharts.refresh();
                    }
                });
            });
            
            // Evidence modal
            document.getElementById('uploadEvidence')?.addEventListener('click', function() {
                document.getElementById('evidenceModal').classList.remove('hidden');
            });
            
            document.getElementById('closeEvidenceModal')?.addEventListener('click', function() {
                document.getElementById('evidenceModal').classList.add('hidden');
            });
            
            // Export buttons
            document.getElementById('exportPdf')?.addEventListener('click', function() {
                alert('PDF export functionality would be implemented here');
            });
            
            document.getElementById('exportExcel')?.addEventListener('click', function() {
                alert('Excel export functionality would be implemented here');
            });
            
            console.log("PATCH-3 initialization complete");
        });
    </script>
</body>
</html>